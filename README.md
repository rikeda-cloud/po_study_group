# 🧩 TypeScript勉強会課題：APIレスポンス整形ユーティリティを実装せよ

## 背景

あなたはとあるサービスのフロントエンド開発を担当しています。
このサービスが利用するバックエンドAPIは、歴史的な経緯から改修を繰り返しており、フィールドの型が複数存在したり、フィールドが欠けたりしたレスポンスが返ってきます。
このままでは、フロントエンドの予期せぬ挙動やクラッシュの原因となりかねません。

## 課題

APIからのレスポンスを安全に処理し、定義された型に整形するユーティリティ関数 `processApiResponse` を実装・改善してください。

`src/processApiResponse.ts` のみが実装対象です。
初期状態では、この関数は擬似APIから受け取ったデータをそのまま返しているため、テストが全て失敗します。このファイル内であれば、自由にヘルパー関数を作成して良いです。

あなたのゴールは、**すべてのテストが成功する**ようにこの関数を改修することです。

## 評価基準

以下の観点からコードを評価し、議論の材料とします。

1.  **型安全性**: TypeScriptの機能を活かし、不正なデータがアプリケーション内で利用されることを防げているか?
2.  **可読性**: 処理内容が理解しやすいか？
3.  **パフォーマンス**: コードの実行速度が考慮されているか？
4.  **保守性**: 処理内容が理解しやすく、将来の仕様変更にも対応しやすいか?
5.  **複雑度**: 処理が完結で複雑な分岐やネストされたループなどが少ないか?
6.  **堅牢性**: 用意されたテストをパス可能か？

## 評価方法

- 用意されたテストを実行し、`パスしたテストの数(テストケースは10個用意) ×5pt` が付与されます(最大で50pt)。
- AIに下記のプロンプトで評価してもらい、`5項目 ×AIが評価した点数(最大10pt)`が付与されます(最大で50pt)。
```
あなたはプログラムの良し悪しを評価するエージェントです。

プログラムの評価基準として、
1.  **型安全性**: TypeScriptの機能を活かし、不正なデータがアプリケーション内で利用されることを防げているか?
2.  **可読性**: 処理内容が理解しやすいか？
3.  **パフォーマンス**: コードの実行速度が考慮されているか？
4.  **保守性**: 処理内容が理解しやすく、将来の仕様変更にも対応しやすいか?
5.  **複雑度**: 処理が完結で複雑な分岐やネストされたループなどが少ないか?
の5つの項目を評価します。
1項目につき10ptを上限として評価してください。

作成するプログラムは引数に数値を取り、擬似的なfetch関数を実行し、そのレスポンスを決められた型フォーマットに整形して返す関数になります。

下記が型定義と作成したプログラムになります。

{型定義}

{作成したprocessApiResponseのコード}
```

## processApiResponse関数の仕様

processApiResponse関数は疑似APIから返された整形前レスポンス(`RawResponseData`型)を整形し、整形後レスポンス(`ResponseData`型)に変換します。
型情報は `src/define.ts`内に定義されています。

### ディレクトリ構成

```
.
├───docs/
│   └───api.yaml                  # OpenAPI形式のAPI設計書
└───src/
    ├───data.ts                    # 整形関数に渡されるデータと、予期される整形後データ
    ├───define.ts                  # 型定義
    ├───mockFetch.ts               # 疑似APIをfetchする関数
    ├───processApiResponse.test.ts # 事前用意したテスト(data.ts内の情報を使用してテストを実行する)
    └───processApiResponse.ts      # 実装・改善対象のレスポンス整形関数
```

- ResponseDataの`status`は、整形前レスポンスのステータスコードが正常系の場合は`success`, エラー系の場合は`error`となります。
- ResponseDataの`data`は、整形前レスポンスのステータスコードが正常系の場合は整形後ユーザー情報(`User`型)、エラー系の場合は整形前レスポンスのエラーメッセージとなります。
- 整形後ユーザー情報(`User`型)は下記の規則に則って整形されます。
  - user_idはnumber型に統一する。
  - friend_idsはnumberの配列型に統一する。friend_idsがnullの場合は空の配列をセットする。
  - birthdayは`ISO 8601 文字列から生成された Date オブジェクト`に統一する。birthdayがnullの場合、そのユーザー情報は削除する。
  - is_activeが`True`または`1`以外の場合、ユーザー情報を削除する。


## セットアップと実行

1.  依存パッケージをインストールします。
    ```bash
    npm install
    ```

2.  テストを実行します。
    ```bash
    npm test
    ```

3.  linterを実行します。
    ```bash
    npm run lint
    ```
