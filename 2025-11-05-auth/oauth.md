# OAuth 2.0

## OAuth 2.0の4つの主要な要素

- **クライアント**:
    - クライアントアプリケーション
    - アプリケーションのロジックに従い、認可サーバへアクセストークンの発行をリクエストし、発行されたアクセストークンを用いてリソースサーバ内のリソース取得を行う。

- **認可サーバ**:
    - アクセストークンを発行するサーバ
    - クライアントからのアクセストークン発行リクエストをトリガーとし、リソースオーナーに対してクライアントアプリがリソースへアクセスする権限を与えるかを聞く。権限を与える場合、クライアントに対してアクセストークンを発行する。

- **リソースオーナー**:
    - リソースの所有者(基本的にはユーザー)
    - クライアントに対して、自身のリソースへのアクセスを許可する権限を与える。

- **リソースサーバ**:
    - 保護されたリソースをホストするサーバ
    - クライアントから提示されたアクセストークンを検証し、正当であればリソースへのアクセスを許可する。(例: ユーザーのプロフィール画像を保持するAPIサーバ)

## OAuth 2.0の認可フロー

1. **認可リクエスト**:
    - クライアントがリソースオーナーを認可サーバの特定のエンドポイントにリダイレクトさせる。
    - リクエスト送信時、`response_type=code`, `client_id`, `redirect_uri`, `scope`などのパラメータをQueryStringに付与する。

2. **リソースオーナーの同意**:
    - リソースオーナーは認可サーバ上で認証(ログイン)し、クライアントに要求された権限(スコープ)を与えることに同意する。

3. **認可コードの払い出し**:
    - 認可サーバは、リソースオーナーをクライアントの`redirect_uri`にリダイレクトさせます。
    - リダイレクト時、QueryStringに認可コードを付与します。

4. **アクセストークンのリクエスト**:
    - クライアントは受け取った認可コードを使い、認可サーバのトークン発行用エンドポイントにリクエストを送信します。

5. **アクセストークンの発行**:
    - 認可サーバは認可コードを検証し、問題がなければクライアントにアクセストークンと、場合によってはリフレッシュトークンを発行します。

6. **リソースへのアクセス**:
    - クライアントは取得したアクセストークンを使って、リソースサーバに保護されたリソースを要求します。
