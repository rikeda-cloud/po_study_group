# 🍪 Cookie&Session勉強会: APIサーバを作成し、ECサイトを完成させよう

## 背景

あなたはECサイトの新規開発担当者です。
商品のリスト表示、カートへの追加、カート内容の確認といった基本的なECサイトの機能実装を任されました。
ユーザー体験を向上させるため、サーバーサイドでカート情報を管理し、カートの状態が保持される仕組みを導入する必要があります。

## 課題

バックエンドAPIサーバーの実装とフロントエンドプログラムの修正を行い、ECサイトを完成させてください。

`frontend` ディレクトリにひな形が用意されています。
- `/src/app/step1` ショッピングページ
- `/src/app/step2` Loginページとショッピングページ
- `/src/app/step3` Loginページとショッピングページ(step2と同じ)

あなたのゴールは、**APIと連携し、step1からstep3までが意図通りに動くWebサイトを完成させること**です。

## 実装

### step1

`/step1` ページではClientSessionによる買い物カート情報の保持機能を実装します。

1. APIサーバを作成し、２つのエンドポイントを作成してください
    1. `/item/add` リクエストボディに含まれる商品をCookieに追加してください
    2. `/item/delete` クエリストリングに指定された商品をCookieから削除してください
2. フロントエンドを改修し、APIサーバを叩くことによって、カートへの商品の追加・削除を行うように変更してください
3. useStateの初期化時に使用する情報としてCookieから取得したカート情報を使用するようにしてください
4. ブラウザをリロードしてもカートの情報は保持されることを確認してください

### step2

`/step2` ページではServerSessionによるログイン機能・SessionIDによる買い物カート情報の受け渡し機能を実装します。

1. APIサーバを作成し、5つのエンドポイントを作成してください
    1. `/login` ログインしたことのあるユーザーの場合はSessionIDを更新、無いユーザーの場合はメモリ上にユーザー名・SessionID・カート情報を新規作成してください。CookieにSessionIDを追加し、レスポンスを返してください
    2. `/logout` メモリ上のSession情報を削除し、Cookie内のSessionIDを削除してください
    3. `/items` SessionIDに紐付いたカート情報をレスポンスで返してください
    4. `/items/add` リクエストボディに含まれる商品をAPIサーバのメモリ上に追加してください
    5. `/items/delete` クエリストリングに指定された商品をAPIサーバのメモリ上から削除してください
2. フロントエンドを改修し、APIサーバを叩くことによって、ログイン・ログアウト・カートへの商品の追加・削除を行うように変更してください
3. useStateの初期化時に使用する情報としてSessionIDに紐付いたカート情報を使用してください
4. ブラウザをリロードしてもカートの情報は保持されることを確認してください
5. ログアウト後に同じユーザーで再度ログインした際にカート情報が保持されることを確認してください
6. ログアウト後、別ユーザーでログインした際に別ユーザーのカート情報が表示されることを確認してください

### step3

`/step3` ページでは認証サーバによるJWTの発行とAPIサーバによるJWTの検証処理を実装し、ログイン機能・JWTによる買い物カート情報の受け渡し機能を実装します。

1. 認証サーバを作成し、3つのエンドポイントを作成してください
    1. `/login` ユーザー名に紐づくユーザーidを作成してからJWTを発行し、Cookieにセットしてください
    2. `/logout` Cookie内のJWTを削除してください
    3. `/keys` JWT検証用の公開鍵をレスポンスボディで返してください
2. APIサーバを作成し、3つのエンドポイントを作成してください
    1. `/items` JWTを検証し、ユーザーidに紐づくカート情報をレスポンスで返してください
    2. `/items/add` JWTを検証し、ユーザーidに紐づくカート情報からリクエストボディに含まれる商品をメモリ上に追加してください
    3. `/items/delete` JWTを検証し、ユーザーidに紐づくカート情報からクエリストリングに指定された商品をAPIサーバのメモリ上から削除してください
3. フロントエンドを改修し、認証サーバを叩くことによって、ログイン・ログアウトを行うように変更してください
4. フロントエンドを改修し、APIサーバを叩くことによって、カートへの商品の追加・削除を行うように変更してください
5. useStateの初期化時に使用する情報としてユーザーidに紐付いたカート情報を使用してください
6. ブラウザをリロードしてもカートの情報は保持されることを確認してください
7. ログアウト後に同じユーザーで再度ログインした際にカート情報が保持されることを確認してください
8. ログアウト後、別ユーザーでログインした際に別ユーザーのカート女王が表示されることを確認してください

## ルール
1.  ブラウザは使用可能
2.  AIは禁止(ブラウザ検索時に見えてしまう程度ならOK)

## セットアップと実行

1.  `frontend`ディレクトリに移動します。
    ```bash
    cd frontend
    ```

2.  依存パッケージをインストールします。
    ```bash
    npm install
    ```

3.  開発サーバーを起動します。
    ```bash
    npm run dev
    ```

4.  linterを実行します。
    ```bash
    npm run lint
    ```
